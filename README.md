# üé¨ Fliverse - Backend API

<div align="center">

<img src="https://fliverse.es/logo.png" alt="Fliverse Logo" width="200" height="200"/>
  
  **API REST para la plataforma web comunitaria Fliverse**
  
  [![Node.js](https://img.shields.io/badge/Node.js-20+-339933?style=for-the-badge&logo=node.js&logoColor=white)](https://nodejs.org/)
  [![Express](https://img.shields.io/badge/Express-4.21.2-000000?style=for-the-badge&logo=express&logoColor=white)](https://expressjs.com/)
  [![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16+-336791?style=for-the-badge&logo=postgresql&logoColor=white)](https://www.postgresql.org/)
  [![Sequelize](https://img.shields.io/badge/Sequelize-6.37.6-52B0E7?style=for-the-badge&logo=sequelize&logoColor=white)](https://sequelize.org/)

</div>

---

## Tabla de Contenidos

- [Sobre el Proyecto](#sobre-el-proyecto)
- [Caracter√≠sticas](#caracter√≠sticas)
- [Tecnolog√≠as](#tecnolog√≠as)
- [Instalaci√≥n y Configuraci√≥n](#instalaci√≥n-y-configuraci√≥n)
- [API Endpoints](#api-endpoints)
- [Estructura del Proyecto](#estructura-del-proyecto)
- [Documentaci√≥n API](#documentaci√≥n-api)
- [Licencia](#licencia)
- [Autor](#autor)

---

## Sobre el Proyecto

**Fliverse Backend** es la API REST desarrollada como **Proyecto de Fin de Grado (TFG)** que proporciona todos los servicios y funcionalidades necesarias para la plataforma web Fliverse.

### Objetivo Principal

Proporcionar una API robusta y escalable que permita:
- **Autenticaci√≥n** segura de usuarios con JWT y OAuth2 (Google)
- **Gesti√≥n** completa de contenido audiovisual
- **Administraci√≥n** de listas personalizadas y valoraciones
- **Sistema** de comentarios y interacci√≥n social
- **Integraci√≥n** con servicios externos (Azure Storage)

---

## Caracter√≠sticas

### Funcionalidades de la API

- **Sistema de Autenticaci√≥n**
  - Registro e inicio de sesi√≥n con JWT
  - Integraci√≥n con Google OAuth2
  - Middleware de autenticaci√≥n y autorizaci√≥n
  - Sistema de recuperaci√≥n de contrase√±as

- **Gesti√≥n de Contenido**
  - CRUD completo para pel√≠culas y series
  - Sistema de b√∫squeda avanzada
  - Gesti√≥n de im√°genes con Azure Blob Storage

- **Listas y Valoraciones**
  - Creaci√≥n y gesti√≥n de listas personalizadas
  - Sistema de valoraciones (0-10)
  - Seguimiento de contenido visto/por ver

- **Sistema Social**
  - Comentarios en contenido
  - Perfiles de usuario
  - Sistema de notificaciones por email

### Caracter√≠sticas T√©cnicas

- **Seguridad**: Rate limiting, validaci√≥n de datos, encriptaci√≥n
- **Documentaci√≥n**: Swagger/OpenAPI integrado
- **Almacenamiento de im√°genes**: Azure Storage Account

---

## Tecnolog√≠as

### Backend Framework
- **[Node.js](https://nodejs.org/)** - Runtime de JavaScript
- **[Express.js](https://expressjs.com/)** - Framework web

### Base de Datos
- **[PostgreSQL](https://www.postgresql.org/)** - Base de datos relacional
- **[Sequelize](https://sequelize.org/)** - ORM para Node.js

### Autenticaci√≥n y Seguridad
- **[JSON Web Tokens](https://www.npmjs.com/package/jsonwebtoken)** - Autenticaci√≥n
- **[BCrypt](https://www.npmjs.com/package/bcrypt)** - Hash de contrase√±as
- **[Google Auth Library](https://www.npmjs.com/package/google-auth-library)** - OAuth2 con Google
- **[Express Rate Limit](https://www.npmjs.com/package/express-rate-limit)** - Rate limiting

### Servicios Externos
- **[Azure Blob Storage](https://www.npmjs.com/package/@azure/storage-blob)** - Almacenamiento de archivos
- **[Nodemailer](https://www.npmjs.com/package/nodemailer)** - Env√≠o de emails
- **[Multer](https://www.npmjs.com/package/multer)** - Manejo de archivos

### Documentaci√≥n y Desarrollo
- **[Swagger UI Express](https://www.npmjs.com/package/swagger-ui-express)** - Documentaci√≥n interactiva
- **[Swagger JSDoc](https://www.npmjs.com/package/swagger-jsdoc)** - Generaci√≥n de documentaci√≥n
- **[Nodemon](https://www.npmjs.com/package/nodemon)** - Desarrollo con hot reload

### Utilidades
- **[Dotenv](https://www.npmjs.com/package/dotenv)** - Variables de entorno
- **[Generate Password](https://www.npmjs.com/package/generate-password)** - Generaci√≥n de contrase√±as aleatorias

---

## Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

Aseg√∫rate de tener instalado:
- **Node.js** (versi√≥n 18 o superior)
- **npm** (viene con Node.js)
- **PostgreSQL** (versi√≥n 14 o superior)

```bash
# Verificar versiones
node --version
npm --version
psql --version
```

### Instalaci√≥n

1. **Clonar el repositorio**
   ```bash
   git clone https://github.com/BetaGun03/fliverse-backend.git
   cd fliverse-backend
   ```

2. **Instalar dependencias**
   ```bash
   npm install
   ```

3. **Configurar variables de entorno**
   ```bash
   # Crear archivo .env en la ra√≠z del proyecto
   touch .env
   ```

   Configurar las siguientes variables en `.env`:
   ```env
   # Puerto del servidor
   PORT=3000

   # Base de datos
   PGUSER=tu_usuario
   PGPASSWORD=tu_contrase√±a
   PGSERVER=direccion_del_servidor

   # Google OAuth
   GOOGLE_CLIENT_ID=tu_google_client_id

   # JWT
   JWT_SECRET=tu_jwt_secret

   # Autenticaci√≥n para Swagger
   SWAGGER_USER=tu_usuario_swagger
   SWAGGER_PASSWORD_HASH=tu_contrase√±a_swagger_hasheada

   # Email de Zoho
   ZOHO_USER=tu_email
   ZOHO_PASSWORD=tu_contrase√±a_email

   # Azure Storage Account
   AZURE_STORAGE_ACCOUNT_NAME=tu_azure_storage_account_name
   AZURE_STORAGE_ACCOUNT_KEY=tu_azure_storage_account_key
   AZURE_STORAGE_CONTAINER_NAME=tu_contenedor
   AZURE_STORAGE_CONNECTION_STRING=tu_connection_string_para_azure

   # CORS
   ALLOWED_ORIGIN=http://tu_dominio_frontend
   ALLOWED_ORIGIN_LOCAL=http://localhost:3000
   ```

4. **Iniciar el servidor**
   ```bash
   nodemon ./app.js
   ```

5. **Verificar instalaci√≥n**
   ```
   Servidor local (redirecciona hacia la documentaci√≥n): http://localhost:3000
   Documentaci√≥n de la API: http://localhost:3000/api-docs
   ```

---

## Endpoints de la API

### Usuarios
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/users/register` | Registro de usuario |
| `POST` | `/users/login` | Inicio de sesi√≥n |
| `POST` | `/users/loginGoogle` | Autenticaci√≥n con Google |
| `POST` | `/users/logout` | Cierre de sesi√≥n |
| `POST` | `/users/logoutAll` | Cerrar sesi√≥n en todos los dispositivos |
| `GET` | `/users/me` | Obtener perfil del usuario autenticado |
| `PATCH` | `/users/me` | Actualizar perfil del usuario |
| `DELETE` | `/users/me` | Eliminar cuenta del usuario |
| `GET` | `/users/me/profile_pic` | Obtener imagen de perfil |

### Contenido
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/contents` | Crear nuevo contenido |
| `PATCH` | `/contents/:id` | Actualizar contenido espec√≠fico |
| `GET` | `/contents/searchById` | Buscar contenido por ID |
| `GET` | `/contents/searchByTitle` | Buscar contenido por t√≠tulo |
| `GET` | `/contents/posterById` | Obtener p√≥ster por ID |
| `GET` | `/contents/posterByTitle` | Obtener p√≥ster por t√≠tulo |
| `GET` | `/contents/random` | Obtener contenido aleatorio |
| `GET` | `/contents/latest` | Obtener contenido m√°s reciente |
| `GET` | `/contents/genres` | Obtener g√©neros disponibles |

### Listas
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/lists` | Crear nueva lista |
| `GET` | `/lists` | Obtener listas del usuario |
| `GET` | `/lists/:id` | Obtener lista espec√≠fica por ID |
| `PATCH` | `/lists/:id` | Actualizar lista espec√≠fica |
| `POST` | `/lists/:id/contents` | A√±adir contenido a lista espec√≠fica |

### Comentarios
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/comments` | Crear nuevo comentario |
| `GET` | `/comments/:id` | Obtener comentario espec√≠fico |
| `GET` | `/comments/content/:contentId` | Obtener comentarios de un contenido |

### Valoraciones
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/ratings` | Crear nueva valoraci√≥n |
| `GET` | `/ratings` | Obtener valoraciones del usuario |
| `GET` | `/ratings/:contentId` | Obtener valoraci√≥n espec√≠fica por contenido |
| `PATCH` | `/ratings/:contentId` | Actualizar valoraci√≥n de contenido |
| `DELETE` | `/ratings/:contentId` | Eliminar valoraci√≥n de contenido |
| `GET` | `/ratings/average/:contentId` | Obtener valoraci√≥n promedio de contenido |

### Contenido-Usuario (Seguimiento)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/contents_user` | Marcar contenido como visto/por ver |
| `GET` | `/contents_user` | Obtener relaciones contenido-usuario |
| `GET` | `/contents_user/watched` | Obtener contenido marcado como visto |
| `GET` | `/contents_user/:contentId` | Obtener relaci√≥n espec√≠fica contenido-usuario |
| `PATCH` | `/contents_user/:contentId` | Actualizar estado de contenido |
| `DELETE` | `/contents_user/:contentId` | Eliminar seguimiento de contenido |

---

## Estructura del Proyecto

```
‚îú‚îÄ‚îÄ üìÑ app.js                    # Archivo principal de la aplicaci√≥n
‚îú‚îÄ‚îÄ üìÑ package.json              # Dependencias y scripts
‚îú‚îÄ‚îÄ üìÑ vercel.json              # Configuraci√≥n de despliegue en Vercel
‚îú‚îÄ‚îÄ üìÅ api-docs/                # Configuraci√≥n de la documentaci√≥n Swagger
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ swagger.js           # Configuraci√≥n de Swagger
‚îú‚îÄ‚îÄ üìÅ config/                  # Configuraciones
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ azureStorage.js      # Configuraci√≥n Azure Storage
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ mailer.js            # Configuraci√≥n de email
‚îú‚îÄ‚îÄ üìÅ db/                      # Base de datos
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ sequelizeConnection.js # Conexi√≥n Sequelize para la base de datos
‚îú‚îÄ‚îÄ üìÅ html-templates/          # Plantillas de email
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ loginEmail.html      # Email de inicio de sesi√≥n
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ logoutFromAllDevices.html     # Email de cierre de sesi√≥n en todos los dispositivos
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ registerEmail.html   # Email de registro
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ userUpdatedInfo.html   # Email de actualizaci√≥n de informaci√≥n del usuario
‚îú‚îÄ‚îÄ üìÅ middlewares/             # Middlewares personalizados
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth.js              # Middleware de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ express-rate-limit.js # Rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ swaggerAuth.js       # Autenticaci√≥n Swagger
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ upload.js            # Manejo de archivos
‚îú‚îÄ‚îÄ üìÅ models/                  # Modelos de Sequelize
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ comment.js           # Modelo de comentarios
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ content_list.js      # Modelo de contenido-lista
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ content_user.js      # Modelo de contenido-usuario
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ content.js           # Modelo de contenido
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ list.js              # Modelo de listas
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ rating.js            # Modelo de valoraciones
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ relations.js         # Relaciones entre modelos
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ user.js              # Modelo de usuario
‚îî‚îÄ‚îÄ üìÅ routers/                 # Rutas de la API
    ‚îú‚îÄ‚îÄ üìÑ comment.js           # Rutas de comentarios
    ‚îú‚îÄ‚îÄ üìÑ content_user.js      # Relaciones usuario-contenido
    ‚îú‚îÄ‚îÄ üìÑ content.js           # Rutas de contenido
    ‚îú‚îÄ‚îÄ üìÑ list.js              # Rutas de listas
    ‚îú‚îÄ‚îÄ üìÑ rating.js            # Rutas de valoraciones
    ‚îî‚îÄ‚îÄ üìÑ user.js              # Rutas de usuarios
```

---

## Documentaci√≥n API

La API incluye documentaci√≥n interactiva generada autom√°ticamente con Swagger/OpenAPI.

### Acceso a la Documentaci√≥n

- **Desarrollo**: [http://localhost:3000/api-docs](http://localhost:3000/api-docs)

### Caracter√≠sticas de la Documentaci√≥n

- **Interfaz Interactiva**: Probar endpoints directamente desde el navegador
- **Esquemas Detallados**: Modelos de datos completos
- **Ejemplos de Uso**: Requests y responses de ejemplo
- **Autenticaci√≥n**: Soporte para testing con JWT

---

## Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

---

## Autor

**Jaime Hedrera Rosa** - *Desarrollador Full Stack*

- **Portafolio**: [jaimehedrera.es](https://jaimehedrera.es)
- **LinkedIn**: [Jaime Hedrera Rosa](https://www.linkedin.com/in/jaimehedrerarosa)
- **Email**: [business@jaimehedrera.es](mailto:business@jaimehedrera.es)
- **GitHub**: [@BetaGun03](https://github.com/BetaGun03)

---

<div align="center">
  <p>Desarrollado como TFG por Jaime Hedrera Rosa.</p>
</div>